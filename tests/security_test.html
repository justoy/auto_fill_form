<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Security Test - Unauthorized Message Blocking</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
    .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    button { margin: 5px; padding: 10px 20px; }
  </style>
</head>
<body>
  <h1>Extension Security Test</h1>
  <p>This test verifies that unauthorized messages to the extension are properly blocked.</p>

  <button onclick="testUnauthorizedMessage()">Test Unauthorized Access (Any Action)</button>
  <button onclick="testExtensionComponents()">Test Extension Components Access</button>
  <button onclick="clearResults()">Clear Results</button>

  <div id="results"></div>

  <script>
    function addResult(message, isSuccess) {
      const resultsDiv = document.getElementById('results');
      const resultDiv = document.createElement('div');
      resultDiv.className = `test-result ${isSuccess ? 'success' : 'error'}`;
      resultDiv.textContent = message;
      resultsDiv.appendChild(resultDiv);
    }

    async function testUnauthorizedMessage() {
      try {
        // Test multiple actions - all should be blocked from external sources
        const actions = ['GET_LLM_CONFIG', 'GET_PROFILE', 'GET_FORM_MAPPING', 'GET_ENABLED'];

        for (const action of actions) {
          const response = await chrome.runtime.sendMessage({
            action: action
          });

          if (response.error === 'Unauthorized sender') {
            addResult(`✅ SUCCESS: ${action} properly blocked`, true);
          } else {
            addResult(`❌ FAIL: ${action} was not blocked`, false);
          }
        }
      } catch (error) {
        addResult(`✅ SUCCESS: All messages blocked with error: ${error.message}`, true);
      }
    }

    async function testExtensionComponents() {
      // This test would need to be run from within the extension
      addResult('ℹ️ INFO: Extension component tests must be run from popup/options page', true);
      addResult('ℹ️ INFO: All extension components (popup, content scripts) share the same sender.id', true);
    }

    function clearResults() {
      document.getElementById('results').innerHTML = '';
    }
  </script>
</body>
</html>
